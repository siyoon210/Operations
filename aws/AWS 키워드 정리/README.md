## 1. 환경 구성

### EC2 (Elastic Compute Cloud)
- 아마존에서 제공하는 가상서버

### AMI (Amazon Machine Image)
- 생성할 EC2 인스턴스를 시작하는데 필요한 **소프트웨어** 구성(운영 체제, 애플리케이션)등이 포함된 템플릿이다.
  - ex) 우분투 운영체제에 Java가 기본으로 설치되어 있는 이미지
  - 하드웨어적인 스펙은 포함되지 않는다. (하드웨어 스펙은 '인스턴스 유형'정보다.)
- 특정 코드가 배포되어 있는 버전도 만들 수 있다. (이를 활용하여 같은 버전의 인스턴스들을 빠르게 늘리는데 사용)
- 커스텀한 이미지를 임의로 만들수 있다.

### 보안그룹
- EC2 서버 보안을 위해서 허용하거나 허용하지 않을 IP주소, 포트번호를 지정해둔 서버 접속 규칙
- ex) ssh 포트는 특정 IP(회사 IP, 집 IP)만 허용하고 http/https 포트는 모든 IP를 허용하는 보안그룹을 만들 수 있다.

### 키페어
- EC2 접속을 위한 개인키, 공개키는 서버에 있고 사용자는 개인키로 접속하게 된다.

### Launch Template (시작 템플릿)
- EC2 인스턴스를 빠르게 생성하기 위한 템플릿
- AMI + 인스턴스 유형(하드웨어 스펙) + 보안그룹 + 키페어 + ...

### AWS Auto Scaling 그룹 (ASG)
- AWS에서 제공하는 다중 서버 서비스다. (같은 사양 같은 환경 같은 코드를 가지고 있는 EC2인스턴스의 묶음) 예를들어 CPU 사용량이 90%이상이거나 특정 시간에 EC2인스턴스들을 더 생성하여서 트래픽을 감당하도록 만든다.
- 다중 서버이니 당연히 로드밸런스가 필요하다.
- cf: scale out - 서버의 대수를 늘리는 방법, scale up - 서버의 성능을 늘리는 방법

### AWS ELB (Elastic Load Balancing)
- AWS에서 제공하는 로드밸런스 서비스
- ELB도 하나의 서버이지만 직접 ssh로 접근할 수는 없다.
- ELB의 종류로는 ALB, NLB, CLB가 있는데, HTTP와 HTTPS를 사용하는 경우 ALB를 사용한다.
    - NLB는 높은 성능의 TCP 서버, CLB는 예전 버전

### 대상 그룹(target group)
- ELB의 요청 대상이 되는 개념적인 그룹
- EC2나 ASG가 포함될 수 있다.
- 로드밸런스는 EC2나 ASG에 직접적으로 등록하지 않고 반드시 대상 그룹을 통해서 연결된다.
- 여러 대상그룹을 두는 것의 이점 
  - 요청한 포트에 따라 다른 대상그룹으로 요청을 보내는 것이 가능해진다. 예를들어 80포트는 A대상그룹, 443포트는 B대상그룹...
  - 예상하건데 굳이 이런 경우가 많지 않을것으로 생각된다. 그래서 일반적인 경우는 하나의 ELB가 하나의 대상 그룹만을 갖을것으로 생각됨..

### 상태검사 (health check)
- 로드밸런스가 관리하는 서버들이 정상적으로 동작하고 있는데 확인하는 과정
- ex) GET /health 라는 요청을 서버에게 보내서 200이라는 응답이 나오면 정상으로 판단한다.

### Route 53
- 도메인을 등록 대행해주는 AWS 서비스
- cf) DNS (Domain Name System) 마지막 S는 서버가 아니다.
- Route 53으로 관리하는 도메인을 ELB로 바로 연결할 수 있다.
    - 해당 도메인으로 접속하는 클라이언트는 만들어둔 ELB로 접속하게 된다!

### AWS Certificate Manager
- HTTPS 프로토콜 지원을 위해서 SSL/TLS 인증서를 등록하게 해주는 서비스

---

## 2. 배포과정

### 무중단배포 / 중단배포
- 말그대로 배포과정중에 서비스가 중단되는지 안되는지의 차이
- 중단배포를 선택해야 하는 경우
  1. 무중단 배포를 하기위해서 투자되는 자원이 굳이 필요 없는 경우
  2. 한 서비스 내에서 구버전 신버전이 동시에 서비스 되면 안되는 경우 (ex 게임)나
- 무중단 배포를 하기 위해서는 로드밸런스와 다중서버가 필요하다.
  
### 현재 위치 배포 (In-place deployment)
- 무중단 배포를 하기 위한 기법 중 하나
- ex) 하나의 로드밸런스와 A, B, C, D 4대의 서버가 있을때, 2개의 서버만 요청을 받도록 한 다음 나머지 2개의 서버를 배포를 진행한다. 그리고 배포가 완료된 2개의 서버로 요청을 받도록 한다음에 나머지 2개의 서버를 배포한다.
- 즉 가용되는 서버를 나눠서 순차대로 배포하는것
- 장점: 새로운 인스턴스를 생성하지 않기 때문에 다른 기법에 비해 비교적 빠르다.
- 단점: 배포된느 순간에는 가용되는 서버 인스턴스가 줄어든다.

### 블루/그린 배포 (Blue/Green)
- 무중단 배포를 하기 위한 기법 중 하나
- 로드밸런스를 기준으로 2개의 그룹 블루/그린으로 나눈다. 여기서 그룹은 대상그룹이 될 수 도 있고 Auto Scaling Group이 될수도 있다.
- 현재 배포되어있는 서비스되는 그룹과 대기중인 그룹으로 나누어서, 배포를 실행하면 대기중인 그룹에 인스턴스를 생성하고 배포를 진행한다. 
- 장점 
  1. 배포 구,신버전이 동시에 떠 있는 시간이 매우 짧게 처리할 수 있다.
  2. 배포 버전의 문제 발견시에 롤백이 빠르다. 이전 그룹을 바로 죽이지 않고 살려둔다음에 문제가 발견되면 바로 롤팩시킬 수 있음.
  3. 배포과정에서 가용되는 서버 인스턴스의 수가 줄지 않는다.
- 단점 : 새로운 인스턴스를 생성해야 하므로 배포 시간이 다른 기법에 비해 비교적 느리다.

### 서버내 블루/그린 배포
- 블루 그린배포 기법을 로드밸런스가 기준이 되는 것이 아니라, 하나의 서버에서 포트 번호로 구분하여 구현하는 방식

---

## AWS 이외에 키워드
## 웹서버 vs 웹 애플리케이션 서버(WAS)
- 웹서버는 정적인 파일(HTML, CSS, JS, 이미지..)만 처리하고, 웹 애플리케이션 서버는 요청을 코드로 통해 가공하여서 보내줄 수 있다.
- nginx,Phusion Passenger는 웹서버이고, tomcat은 WAS다.
- 그래서 WAS는 사용되는 코드 언어마다 다른 걸 써야 할 수도 있다. 톰캣은 자바용!


#### 참고
- 서비스 운영이 쉬워지는 AWS 인프라 구축 가이드 (위키북스)